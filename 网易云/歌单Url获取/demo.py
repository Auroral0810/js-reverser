import requests
import execjs


csrf_token = '703c303980fe98c1064ed531803d6b5c'

cookies = {
    '_ntes_nnid': '20e442659d79d6c0a6d8c7aa82074f90,1713420636872',
    '_ntes_nuid': '20e442659d79d6c0a6d8c7aa82074f90',
    '_ga': 'GA1.1.1492695192.1720416908',
    '_clck': '1b0kmll%7C2%7Cfna%7C0%7C1650',
    '_ga_PTGVM6PCHS': 'GS1.1.1720416907.1.1.1720416967.0.0.0',
    'NMTID': '00OwXvszvaHOwafPkKrrViMZHRN75wAAAGUTzapVQ',
    '_iuqxldmzr_': '32',
    'WEVNSM': '1.0.0',
    'WNMCID': 'dehirs.1736495770956.01.0',
    'sDeviceId': 'YD-iCVIUS%2FKN7FFQwAURVaEvOm79jRIU%2BDe',
    '__snaker__id': 'AK8s3TXWYoxBcwJl',
    'NTES_P_UTID': 'vdw2AldMLX7G1OaMM0r0NecnctFFlope|1736655377',
    'WM_TID': 'uxmJeToLndBBAFBUERPXM7ymw7jNHf0M',
    'WM_NI': 'AizfDob%2BjjFKgW6B5nbH8v9hxDtYBMx1k0a9oskwvgxVTrALSOl2Klk6OeHi4dV%2BWUTYqiLOZ84EBafIgV7%2FnbEG6q6YaDB7Oc%2BXqzDukF1rkJ45r6RHJQSvlTLOfZEuS0c%3D',
    'WM_NIKE': '9ca17ae2e6ffcda170e2e6ee83d07bb79ba584ef44a3a88fb6c55b928f9facd76f86eda389cc338abc878bc92af0fea7c3b92a83b7b687c765a2f5a68bc541a589faa3b866a298f897bc64bc9cbcbac147bcefa5d1e433adada598f56dbc8a9c93c4489191a4d3ca68a9ea8186cb63f8bc9accd65f9887bf8acf459ae8fca6c16ba697a9b7b625aebe8ba8b57bf687afa5c13d8dbde5b9f47288aba5a7b47aa996fcd6f13e929886b2d27eb08c84b0e55287ab9dd1e237e2a3',
    'ntes_utid': 'tid._.owZ6VcKgvXtARlEBVVeXeRznlZ8xfp59._.0',
    'csrfToken': 'TCHm6FCms6LeucjmhW9mLkLG',
    'gdxidpyhxdE': 'sYqSPse9yXvPP7K6HLwJhcpkr%2FksbiAMjPYmouMmbdmv2WtmdkcuvvqcLtN7RVwyt3vj0BHljr3fGgk7YpAtZxXPpJG7ECG7ujq8XDaih5bipb%5CEytjEoCYfEwZx6Rd%2BswmYs6PqGqEtYl2Tzgb%2FV%5CYuLSs%5C0fKTDLwo%5ClQeZEwuxAPd%3A1744521810104',
    '__csrf': csrf_token,
    'MUSIC_U': '0007BD3FFB8EE768A2A073BEF9C08C52F3144A9C43EA2FB6C9E2ED3158E93864512D94B1D8D5EA00A31BD6CFB44FBF6618C8D18A18DF249DE94CCD021F3F517AC666FDFA327B46ABA565C8C3D2AFB589E1035A48A2467511BC7ACA7A81D1B507CA03545B752058BC7B8BA2A93D81606612537A7E0568F08EC2FDD4DD645078702B18A916D95752A488776504ED4721340A371BF260CDA612E603BDFAD2363A28D34D764C87CD3809253FA7CDBD017BE0611F8F86DE6B2BD03D28255864FCB9241CD10101003C38890CCE044B7B4876B2BE01034C507099F1A801235EB3B7E1AF9E11F173CF0BBD15B777120583BD7DE0FD428C1F09642669ACA6834B9ADF7A4C9DA90A0CDA5BDB0321D2FC478BACE9E53D485F90214FC239D18CF0E699B162C3CCE5EA3C4E8B7D7CC8E5FB636015C7B5D29760C114FE450D1F0114C5E60E096330939EFEE30CD57F3D1ECA3F463C397A627BD7ADB6B31761D0627A9C03E7C129E7',
    'ntes_kaola_ad': '1',
    'playerid': '61918376',
    'JSESSIONID-WYYY': 'HXBDNDPD%2BsvF9eCDOGxVffGnUlw5tGYg0gA3j0p8w7fRZqK0rdHB567Rz3VNh901jxsAEDbD0YuRIYWvhESdcFQm8rxAg7wFJcXO39rJR%5CGJJSInXCMYw1ocuqnuvjseUvy3jGhf2nhw4jh0Mj2wWuDQpMruJW2zOVGQ0dJoOc%5ClQKtw%3A1744524506600',
}
headers = {
    'accept': '*/*',
    'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'cache-control': 'no-cache',
    'content-type': 'application/x-www-form-urlencoded',
    'origin': 'https://music.163.com',
    'pragma': 'no-cache',
    'priority': 'u=1, i',
    'referer': 'https://music.163.com/',
    'sec-ch-ua': '"Google Chrome";v="135", "Not-A.Brand";v="8", "Chromium";v="135"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"macOS"',
    'sec-fetch-dest': 'empty',
    'sec-fetch-mode': 'cors',
    'sec-fetch-site': 'same-origin',
    'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36',
    # 'cookie': '_ntes_nnid=20e442659d79d6c0a6d8c7aa82074f90,1713420636872; _ntes_nuid=20e442659d79d6c0a6d8c7aa82074f90; _ga=GA1.1.1492695192.1720416908; _clck=1b0kmll%7C2%7Cfna%7C0%7C1650; _ga_PTGVM6PCHS=GS1.1.1720416907.1.1.1720416967.0.0.0; NMTID=00OwXvszvaHOwafPkKrrViMZHRN75wAAAGUTzapVQ; _iuqxldmzr_=32; WEVNSM=1.0.0; WNMCID=dehirs.1736495770956.01.0; sDeviceId=YD-iCVIUS%2FKN7FFQwAURVaEvOm79jRIU%2BDe; __snaker__id=AK8s3TXWYoxBcwJl; NTES_P_UTID=vdw2AldMLX7G1OaMM0r0NecnctFFlope|1736655377; WM_TID=uxmJeToLndBBAFBUERPXM7ymw7jNHf0M; JSESSIONID-WYYY=k2MuH8M32E509h8bHtJkuaTtXmjwaxb%2FASWNr4xbjAksbxubU4m4kK%2ByF9bPxrzWACzk9dB3q0Fsck%2FGMXyR2ROrHozhfrobo%2BslwQg7N1Ief9ch%5C5Wa540WUhGmZl%2B0coeWnYNFAZtZEe4h%5C2m6unXqQN4F3qGvB1VslbsCE8mngjSu%3A1744522614118; WM_NI=AizfDob%2BjjFKgW6B5nbH8v9hxDtYBMx1k0a9oskwvgxVTrALSOl2Klk6OeHi4dV%2BWUTYqiLOZ84EBafIgV7%2FnbEG6q6YaDB7Oc%2BXqzDukF1rkJ45r6RHJQSvlTLOfZEuS0c%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6ee83d07bb79ba584ef44a3a88fb6c55b928f9facd76f86eda389cc338abc878bc92af0fea7c3b92a83b7b687c765a2f5a68bc541a589faa3b866a298f897bc64bc9cbcbac147bcefa5d1e433adada598f56dbc8a9c93c4489191a4d3ca68a9ea8186cb63f8bc9accd65f9887bf8acf459ae8fca6c16ba697a9b7b625aebe8ba8b57bf687afa5c13d8dbde5b9f47288aba5a7b47aa996fcd6f13e929886b2d27eb08c84b0e55287ab9dd1e237e2a3; ntes_utid=tid._.owZ6VcKgvXtARlEBVVeXeRznlZ8xfp59._.0; csrfToken=TCHm6FCms6LeucjmhW9mLkLG; gdxidpyhxdE=sYqSPse9yXvPP7K6HLwJhcpkr%2FksbiAMjPYmouMmbdmv2WtmdkcuvvqcLtN7RVwyt3vj0BHljr3fGgk7YpAtZxXPpJG7ECG7ujq8XDaih5bipb%5CEytjEoCYfEwZx6Rd%2BswmYs6PqGqEtYl2Tzgb%2FV%5CYuLSs%5C0fKTDLwo%5ClQeZEwuxAPd%3A1744521810104; __csrf=703c303980fe98c1064ed531803d6b5c; MUSIC_U=0007BD3FFB8EE768A2A073BEF9C08C52F3144A9C43EA2FB6C9E2ED3158E93864512D94B1D8D5EA00A31BD6CFB44FBF6618C8D18A18DF249DE94CCD021F3F517AC666FDFA327B46ABA565C8C3D2AFB589E1035A48A2467511BC7ACA7A81D1B507CA03545B752058BC7B8BA2A93D81606612537A7E0568F08EC2FDD4DD645078702B18A916D95752A488776504ED4721340A371BF260CDA612E603BDFAD2363A28D34D764C87CD3809253FA7CDBD017BE0611F8F86DE6B2BD03D28255864FCB9241CD10101003C38890CCE044B7B4876B2BE01034C507099F1A801235EB3B7E1AF9E11F173CF0BBD15B777120583BD7DE0FD428C1F09642669ACA6834B9ADF7A4C9DA90A0CDA5BDB0321D2FC478BACE9E53D485F90214FC239D18CF0E699B162C3CCE5EA3C4E8B7D7CC8E5FB636015C7B5D29760C114FE450D1F0114C5E60E096330939EFEE30CD57F3D1ECA3F463C397A627BD7ADB6B31761D0627A9C03E7C129E7; ntes_kaola_ad=1',
}


params = {
    'csrf_token': csrf_token,
}

with open('netease.js','r',encoding='utf-8') as f:
    js = f.read()

ctx = execjs.compile(js)
# 直接调用d函数(asrsea)而不是getParams/getEncSecKey
result = ctx.call('d',
    '{"ids":"[30612793]","level":"standard","encodeType":"aac","csrf_token":"703c303980fe98c1064ed531803d6b5c"}',
    '010001',
    '00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7',
    '0CoJUm6Qyw8W8jud')
data_params = result['encText']
data_encSecKey = result['encSecKey']

data = {
    'params': data_params,
    'encSecKey': data_encSecKey
}

response = requests.post(
    'https://music.163.com/weapi/song/enhance/player/url/v1',
    params=params,
    cookies=cookies,
    headers=headers,
    data=data,
).json()


# 获取歌单url
url = response['data'][0]['url']
print(url)


# # 根据url下载歌曲
# response = requests.get(url)
# with open('test.mp3', 'wb') as f:
#     f.write(response.content)
